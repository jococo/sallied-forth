/*! salliedforth 2013-Dec-26 */
!function(){alert("Hey!")}(),function(a){"use strict";var b=function(a,b,c,d){var e=this;this.name=a,this.fn=function(){e.functions.forEach(function(a){a.call(c)})},this.errorFn=d||function(a){console.error("FORTH ERROR::CustomCommand: "+a)},this.prev=b,this.functions=[],this.addFunction=function(a){"function"!=typeof a&&e.errorFn("addFunction can only be called with a function ref as argument!"),e.functions.push(a)}};a.Interpreter=function(){var a=this;this.dataStack=[],this.returnStack=[],this.dictionary=void 0,this.dictionaryHead=void 0,this.valueStore={"false":!1,"true":!0},this.version={major:0,minor:0,build:1,revision:void 0},this.versionString=""+this.version.major+"."+this.version.minor+"."+this.version.build,this.version.revision&&(this.versionString=this.versionString+"."+this.version.revision),this.log=function(b){return a.logFn&&a.logFn(b),void 0},this.error=function(b){return a.errorFn&&a.errorFn(b),void 0},this.pushToDataStack=function(){var b=Array.prototype.slice.call(arguments);b.forEach(function(b){a.dataStack.push(b)})},this.popFromDataStack=function(){return a.dataStack.pop()},this.addToDictionary=function(b,c,d){if(a.dictionaryHead){var e={name:b,fn:c,prev:a.dictionaryHead,immediate:!!d};a.dictionaryHead=e}else a.dictionary=a.dictionaryHead={name:b,fn:c,immediate:!!d}},this.setValue=function(a,b){this.valueStore[a]=b},this.getValue=function(a){return this.valueStore[a]},this.findDefn=function(b,c){return c===b.name?b:b.prev?a.findDefn(b.prev,c):void 0},this.findDefinition=function(b){if(a.dictionaryHead){var c=a.findDefn(a.dictionaryHead,b);return c}return void 0},this.executeFunctions=function(){var b=Array.prototype.slice.call(arguments);b.forEach(function(b){b.call(a)})},this.executeWords=function(){var b=Array.prototype.slice.call(arguments);try{var c=b.map(function(b){var c=a.findDefinition(b);if(c)return c.fn;throw"Function "+b+" not found!"});a.executeFunctions.apply(a,c)}catch(d){a.error(d)}},this.processCommands=function(){for(var b;b=a.commands.shift();)if(b){var c=parseFloat(b);if(isNaN(c))if(a.compilationMode){var d=a.findDefinition(b);d.immediate?d.fn():a.newCommand.addFunction(d.fn)}else a.executeWords(b);else a.compilationMode?a.newCommand.addFunction(function(b){return function(){a.pushToDataStack(b)}}(c)):a.pushToDataStack(c)}},this.interpret=function(b){return a.response="",a.commands=b.split(" "),a.processCommands(),a.response.trim()},this.logFn=function(b){a.response+=b+" "},this.setLogFunction=function(a){this.logFn=a},this.errorFn=function(a){throw"FORTH ERROR: "+a},this.setErrorFunction=function(a){this.errorFn=a},this.addToDictionary(".",function(){a.log(a.popFromDataStack())}),this.addToDictionary("true",function(){a.pushToDataStack(a.getValue("true"))}),this.addToDictionary("false",function(){a.pushToDataStack(a.getValue("false"))}),this.addToDictionary(".s",function(){a.dataStack.length<1?a.log("[stack empty]"):a.log("["+a.dataStack.join(",")+"]")}),this.addToDictionary(".l",function(){a.log(a.dataStack.length)}),this.addToDictionary(".cs",function(){a.dataStack.length=0}),this.addToDictionary("dup",function(){var b=a.popFromDataStack();b&&(a.pushToDataStack(b),a.pushToDataStack(b))}),this.addToDictionary("drop",function(){a.popFromDataStack()}),this.addToDictionary("swap",function(){if(a.dataStack.length>1){var b=a.popFromDataStack(),c=a.popFromDataStack();a.pushToDataStack(b,c)}}),this.addToDictionary("over",function(){if(a.dataStack.length>1){var b=a.dataStack[a.dataStack.length-2];a.pushToDataStack(b)}}),this.addToDictionary("roll",function(){if(a.dataStack.length<2)a.error("ROLL needs something to work with, nothing on stack!");else{var b=a.popFromDataStack();if(a.dataStack.length<b+1)a.error("ROLL specifed a larger number then number of items on stack!");else{var c=a.dataStack.splice(a.dataStack.length-b-1,1);a.pushToDataStack(c[0])}}}),this.addToDictionary("+",function(){var b=a.popFromDataStack()||0,c=a.popFromDataStack()||0;a.pushToDataStack(b+c)}),this.addToDictionary("-",function(){var b=a.popFromDataStack()||0,c=a.popFromDataStack()||0;a.pushToDataStack(c-b)}),this.addToDictionary("*",function(){var b;if(a.dataStack.length<1)a.pushToDataStack(1);else if(1===a.dataStack.length)b=a.popFromDataStack()||0,a.pushToDataStack(b);else{b=a.popFromDataStack()||0;var c=a.popFromDataStack()||0;a.pushToDataStack(b*c)}}),this.addToDictionary("/",function(){var b=a.popFromDataStack()||0;if(a.dataStack.length<1)a.pushToDataStack(1);else{var c=a.popFromDataStack()||0;a.pushToDataStack(c/b)}}),this.addToDictionary("%",function(){var b=a.popFromDataStack()||0;if(a.dataStack.length<1)a.pushToDataStack(0),a.pushToDataStack(1);else{var c=a.popFromDataStack()||0,d=Math.floor(c/b);a.pushToDataStack(c-b*d),a.pushToDataStack(d)}}),this.addToDictionary("=",function(){var b=a.popFromDataStack();if(a.dataStack.length<1)a.error("2 items needed for EQUAL!");else{var c=a.popFromDataStack();a.pushToDataStack(b===c)}}),this.addToDictionary("word",function(){var b=a.commands.shift();b&&a.pushToDataStack(b)}),this.addToDictionary("lit",function(){var b=a.commands.shift();b&&a.pushToDataStack(b)},!0),this.addToDictionary("find",function(){var b=a.popFromDataStack(),c=a.findDefinition(b);return c?(a.pushToDataStack(c),void 0):(a.error("Cannot find word '"+b+"'"),void 0)}),this.addToDictionary(">cfa",function(){var b=a.popFromDataStack();b.fn?a.pushToDataStack(b.fn):a.pushToDataStack(b)}),this.addToDictionary("!",function(){if(a.dataStack.length>1){var b=a.popFromDataStack(),c=a.popFromDataStack();a.setValue(c,b)}else a.error("! needs a name and value")}),this.addToDictionary("@",function(){if(a.dataStack.length>0){var b=a.popFromDataStack();a.pushToDataStack(a.getValue(b))}else a.error("@ needs a name input")}),this.addToDictionary("!)?",function(){var b=a.commands.shift();a.pushToDataStack(b.indexOf(")")<0)}),this.addToDictionary("not",function(){a.pushToDataStack(!a.popFromDataStack())}),this.addToDictionary("while",function(){for(;a.popFromDataStack();)a.executeWords("dup","exec");a.executeWords("drop")}),this.addToDictionary("(",function(){for(var b;(b=a.commands.shift())&&-1==b.indexOf(")"););},!0),this.addToDictionary("'",function(){a.executeWords("word","find",">cfa")}),this.addToDictionary("create",function(){if(a.newCommand&&a.error("Already compiling "+a.newCommand.name+"!"),a.dataStack.length>0){var c=new b(a.popFromDataStack(),a.dictionaryHead,a);return a.newCommand=c,void 0}a.error("CREATE needs a name.")}),this.addToDictionary("[",function(){a.compilationMode=!0,a.newCommand||(a.newCommand=new b("Anonymous",void 0,a))}),this.addToDictionary("]",function(){a.compilationMode=!1,a.newCommand&&(a.pushToDataStack(a.newCommand),a.newCommand=void 0)},!0),this.addToDictionary("exec",function(){if(a.dataStack.length>0){var b=a.popFromDataStack();"function"==typeof b?b.call(a):b.fn?b.fn.call(a):a.error(""+b+" is not executable!")}else a.error("exec needs a function or command ref on the stack!")}),this.addToDictionary(";",function(){a.executeWords("]");var b=a.popFromDataStack();if(b){if(b&&b.name){var c=a.findDefinition(b.name);c&&a.log(b.name+" is not unique.")}a.dictionaryHead=b}},!0),this.addToDictionary(":",function(){a.executeWords("word","create","[")}),this.interpret(": rot 2 roll ;"),this.interpret(": inc 1 + ;"),this.interpret(": dec 1 - ;"),this.addToDictionary(".list",function(){var b=a.dictionaryHead;if(b)do a.log(b.name);while(b=b.prev)},!0),this.addToDictionary(".values",function(){var b=Object.getOwnPropertyNames(a.valueStore),c=b.map(function(b){return a.valueStore[b]});a.log(c)}),this.addToDictionary(".keys",function(){var b=Object.getOwnPropertyNames(a.valueStore);a.log(b)}),this.addToDictionary(".vs",function(){a.log(a.valueStore)})}}("undefined"==typeof exports?this.salliedforth={}:exports);